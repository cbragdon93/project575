---
title: "Facebook_Analysis"
author: "Team3"
date: "9/25/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(ggplot2)
library(multcomp)
library(tidyverse)
library(broom)
library(tidyverse)
library(gridExtra)
library(chron)
library(kableExtra)
library(stringr)
# The package I normally use for time series, TSA, got discontinued
# from the CRAN repo. Rather than dealing with archives
# and possible versioning issues, I'm currently using a set of libraries that
# do the same thing
library(fable)
library(forecast)
```


## Facebook

```{r}
facebook<-read.csv("data/facebook/dataset_Facebook.csv", sep=";")
```


```{r}
plotResiduals <- function(mlsModel, data, A, B){
  StanResMLS <- rstandard(mlsModel)
  X=A
  Y=B
  dataMLS <- data.frame(X=data[[A]],Y=data[[B]])
  resVSomething<-ggplot() + 
    geom_point(data=dataMLS, aes(x=X, y=Y, color = "blue"), size = 1) +
    geom_hline(yintercept=2,color='blue') + geom_hline(yintercept=-2, color='blue') + labs(y = "Standarized Residual") + ggtitle("Standarized Residuals MLS Plot")
  print(resVSomething)
  
  
  Fitted = fitted(mlsModel)
dataMLSFitted <- data.frame(Fitted,StanResMLS)

# MLS Stan. Res. vs Fitted plot 
mlsStanFit<-ggplot() +
  geom_point(data=dataMLSFitted, aes(x=Fitted, y=StanResMLS, color = "MLS"), size = 1) +
  geom_hline(yintercept=2,color='blue') + geom_hline(yintercept=-2, color='blue') +
  scale_color_manual(name = element_blank(), labels = c("MLS"), values = c("blue")) +
  labs(y = "Standarized Residual") + labs(x = "Fitted value") + 
  ggtitle("Standarized Residuals MLS Plot (Fitted) ")
  print(mlsStanFit)
  
 }
```


## For report 3


```{r report_3_plotting}
names(facebook)<-gsub("\\.","",names(facebook))

monthSeven <- facebook[ which(facebook$PostMonth==7) , ]
categorical <- c("Category", "Paid", "Type")
notCategorical<-names(facebook)[which(!(names(facebook) %in% categorical))]


ggplot() + 
  geom_point(data=monthSeven, aes(x=PostWeekday, y=log(TotalInteractions)))  +
  theme_bw()


ggpairs(monthSeven[,which(startsWith(names(monthSeven),"Lifetime") | names(monthSeven)=="Pagetotallikes")], 
        lower = list(continuous = wrap("points", alpha = 0.3,    size=0.1)))




```



```{r report_3_mls}
# MLR
monthSeven.mls.categorical <- lm( TotalInteractions ~ PostHour + as.factor(Paid) + 
                                    as.factor(Category) + as.factor(Type), 
                      data=monthSeven )


monthSeven.mls.pageTotalLikes <- lm(Pagetotallikes ~ LifetimePostTotalReach + 
                        LifetimePostTotalImpressions + LifetimeEngagedUsers + 
                        LifetimePostConsumers + LifetimePostConsumptions + 
                        LifetimePostImpressionsbypeoplewhohavelikedyourPage + 
                        LifetimePostreachbypeoplewholikeyourPage + 
                        LifetimePeoplewhohavelikedyourPageandengagedwithyourpost,
  data=monthSeven)

monthSeven.mls.notCategorical <- lm( TotalInteractions ~ PostHour*Paid + Pagetotallikes*LifetimeEngagedUsers, data=monthSeven)

monthSeven.mls.notCategorical.2 <- lm( TotalInteractions ~ PostHour + LifetimeEngagedUsers, data=monthSeven)

summary(monthSeven.mls.notCategorical.2)

```


```{r}
# Diagnostics -------------------------------------------------------------------------------------
# Standard Residuals vs GroundCO
## why are the horizontal lines for the residual plots where they are?
## can we set our own threshold here?
plotResiduals(monthSeven.mls.notCategorical.2, monthSeven, "PostHour", "TotalInteractions")
```














##

### By hour of each day, simple OLM
```{r}
# ggplot doesn't like having the periods in the x,y aesthetic
# I think ggplot tries to find an object Post.Hour...
colnames(facebook)[which(colnames(facebook)=="Post.Hour")]<-"PostHour"
colnames(facebook)[which(colnames(facebook)=="Post.Weekday")]<-"PostWeekday"
lapply(unique(facebook$PostWeekday), function(x){
  # building simple linear models with R.
  # Something we could ask of the facebook data could be
  # "When is the best day to post? Best Hour? Best Day and hour?"
  subsetData = facebook[which(facebook$PostWeekday==x),]
  theseLikes = subsetData$like
  isPaid = subsetData$Paid
  theseHours = subsetData$PostHour
  # extracting slopes, intercepts of model
  # both for paid and unpaid. the result will be marked if significant
  m1 = lm(theseLikes ~ as.factor(isPaid) + theseHours, data=subsetData)
  print(summary(m1))
  thisIntercept = m1$coefficients[[1]]
  paidCoef = m1$coefficients[[2]]
  h = m1$coefficients[[3]]
  ggplot(subsetData, aes(x=PostHour, y=like, col=Paid)) +
  geom_point() +
  # fit the model
  geom_abline(slope = h, intercept=(thisIntercept+paidCoef), color="blue") +
    geom_abline(slope=h, intercept=thisIntercept, color="black") +
  theme_bw() +
  theme(axis.text.x=element_blank(), axis.ticks.x=element_blank()) +
  labs(title=paste0("Facebook Like Activity: PostDay #: ",x), 
       x="post hour", y="likes", col="paid?")
})
```


### uhhhhhh

```{r}
print(names(facebook))
```



```{r}
names(facebook)<-gsub("\\.","",names(facebook))
ggplot(facebook, aes(x=LifetimePeoplewhohavelikedyourPageandengagedwithyourpost,y=Pagetotallikes)) +
  geom_point(size=2) +
  labs(title="UHHHH",xlab="something",ylab="AHHHHHHH") +
  theme_bw()
```


### uuuuuhhhhhhhhhHHHHHHHHHH

```{r}
olsFacebook <- lm(Pagetotallikes ~ LifetimePeoplewhohavelikedyourPageandengagedwithyourpost,data=facebook)
print(summary(olsFacebook))
```



```{r}

```



